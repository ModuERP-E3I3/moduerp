<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
 "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="QnaMapper">
	<resultMap type="com.e3i3.moduerp.qna.model.dto.QnaDto" id="resultQna">
		<result property="qSeq" column="Q_SEQ" />
		<result property="uuid" column="UUID" />
		<result property="empName" column="EMP_NAME" />
		<result property="departmentId" column="DEPARTMENT_ID" />
		<result property="bizNumber" column="BIZ_NUMBER" />
		<result property="qTitle" column="Q_TITLE" />
		<result property="qContents" column="Q_CONTENTS" />
		<result property="qStatus" column="Q_STATUS" />
		<result property="qDate" column="Q_DATE" />
		<result property="isPublic" column="IS_PUBLIC" />
		
	</resultMap>
 
 	<!-- QNA 질문글 전체 조회 쿼리 -->
 	<select id="getAllQna" resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
 		SELECT *
 		FROM QUESTION
 	</select>
 	
 	<!-- 사원 조회 쿼리 -->
 	<select id="getEmpNameDepart" parameterType="map"
		resultType="com.e3i3.moduerp.employee.model.dto.Employee">
		SELECT *
		FROM EMPLOYEE
		WHERE UUID = #{uuid}
	</select>
	
	<!-- 질문글 등록 쿼리 -->
	<insert id="insertQna"
		parameterType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		INSERT INTO QUESTION (
		Q_SEQ,
		UUID,
		EMP_NAME,
		DEPARTMENT_ID,
		BIZ_NUMBER,
		Q_TITLE,
		Q_CONTENTS,
		Q_STATUS,
		Q_DATE,
		IS_PUBLIC
		)
		VALUES (
		QNA_SEQ.NEXTVAL,
		#{uuid},
		#{empName},
		#{departmentId},
		(SELECT BIZ_NUMBER FROM EMPLOYEE WHERE EMP_NAME = #{empName} AND DEPARTMENT_ID =
		#{departmentId} AND ROWNUM = 1),
		#{qTitle},
		#{qContents},
		#{qStatus},
		#{qDate},
		#{isPublic}
		)
	</insert>
	
	<!-- 글 상세 보기 -->
	<select id="selectQnaDetail" parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE Q_SEQ = #{qSeq}
	</select>
	
	<!-- 글 수정 -->
	<update id="updateQuestion"
		parameterType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		UPDATE QUESTION
		SET Q_TITLE = #{qTitle},
		Q_CONTENTS = #{qContents},
		Q_DATE = #{qDate}
		WHERE Q_SEQ = #{qSeq}
	</update>
	
	<!-- 글 삭제 -->
	<delete id="deleteQna" parameterType="int">
		DELETE FROM QUESTION WHERE Q_SEQ = #{qSeq}
	</delete>
	
	<!-- 답변 등록 시 qStatus 'Y'로 업데이트 -->
	<update id="updateQStatus"
		parameterType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		UPDATE QUESTION
		SET Q_STATUS = 'Y'
		WHERE Q_SEQ = #{qSeq}
	</update>
	
	<!-- 답변 삭제 시 qStatus 'Y'로 업데이트 -->
	<update id="updateQStatusN"
		parameterType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		UPDATE QUESTION
		SET Q_STATUS = 'N'
		WHERE Q_SEQ = #{qSeq}
	</update>
	
	<!-- filter 쿼리 -->
	<select id="selectQnaByEmpNameDate"
		parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE EMP_NAME LIKE '%' || #{filterText} || '%'
		AND Q_DATE
		BETWEEN
		TO_DATE(#{startDate}, 'YY-MM-DD HH24:MI:SS') AND
		TO_DATE(#{endDate}, 'YY-MM-DD HH24:MI:SS')
		ORDER BY Q_DATE DESC
	</select>
	
	<select id="selectQnaByQTitleDate"
		parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE Q_TITLE LIKE '%' || #{filterText} || '%'
		AND Q_DATE
		BETWEEN
		TO_DATE(#{startDate}, 'YY-MM-DD HH24:MI:SS') AND
		TO_DATE(#{endDate}, 'YY-MM-DD HH24:MI:SS')
		ORDER BY Q_DATE DESC
	</select>
	
	<select id="selectQnaByEmpName"
		parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE EMP_NAME LIKE '%' || #{filterText} || '%'
		ORDER BY Q_DATE DESC
	</select>
	
	<select id="selectQnaByQTitle"
		parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE Q_TITLE LIKE '%' || #{filterText} || '%'
		ORDER BY Q_DATE DESC
	</select>
	
	<!-- filter(날짜만 입력받은 경우) 쿼리 -->
	<select id="selectQnaByFilterOnlyDate"
		parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE Q_DATE
		BETWEEN
		TO_DATE(#{startDate}, 'YY-MM-DD HH24:MI:SS') AND
		TO_DATE(#{endDate}, 'YY-MM-DD HH24:MI:SS')
		ORDER BY Q_DATE DESC
	</select>
	
	<select id="selectQnaByFilterStartDate"
		parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE Q_DATE >= TO_DATE(#{startDate}, 'YY-MM-DD HH24:MI:SS') 
		ORDER BY Q_DATE DESC
	</select>
	
	<select id="selectQnaByFilterEndDate"
		parameterType="map"
		resultType="com.e3i3.moduerp.qna.model.dto.QnaDto">
		SELECT *
		FROM QUESTION
		WHERE Q_DATE &lt;= TO_DATE(#{endDate}, 'YY-MM-DD HH24:MI:SS')
		ORDER BY Q_DATE DESC
	</select>
</mapper>
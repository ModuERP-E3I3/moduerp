<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AccountMapper">

	<!-- Account에 대한 resultMap -->
	<resultMap id="accountResult"
		type="com.e3i3.moduerp.account.model.dto.AccountDTO">
		<result property="accountNo" column="ACCOUNT_NO" />
		<result property="accountName" column="ACCOUNT_NAME" />
		<result property="businessType" column="BUSINESS_TYPE" />
		<result property="items" column="ITEMS" />
		<result property="bossName" column="BOSS_NAME" />
		<result property="businessNumber" column="BUSINESS_NUMBER" />
		<result property="accountAddress" column="ACCOUNT_ADDRESS" />
		<result property="accountPhone" column="ACCOUNT_PHONE" />
		<result property="email" column="EMAIL" />
		<result property="bizNumber" column="BIZ_NUMBER" />
	</resultMap>

	<!-- 모든 account 데이터 조회용 쿼리 -->
	<select id="getAllAccounts" resultMap="accountResult">
		SELECT * FROM ACCOUNT
	</select>

	<select id="getEmpNameDepart" parameterType="map"
		resultType="com.e3i3.moduerp.employee.model.dto.Employee">
		SELECT *
		FROM EMPLOYEE
		WHERE BIZ_NUMBER = #{bizNumber}
	</select>

	<select id="getAccountsByBizNumber" parameterType="String"
		resultType="AccountDTO">
		SELECT * FROM ACCOUNT WHERE BIZ_NUMBER = #{bizNumber}
	</select>

	<!-- 사원명 조회 쿼리 -->
	<select id="getEmpNamesByBizNumber" resultType="string">
		SELECT EMP_NAME
		FROM EMPLOYEE
		WHERE BIZ_NUMBER = #{bizNumber}
	</select>

	<!-- 부서명 조회 쿼리 -->
	<select id="getDepartmentIdsByBizNumber" resultType="string">
		SELECT
		DEPARTMENT_ID
		FROM EMPLOYEE
		WHERE BIZ_NUMBER = #{bizNumber}
	</select>

	<!-- 거래처정보 조회 쿼리 -->
	<select id="getAccountsByAccountNo"
		resultType="com.e3i3.moduerp.account.model.dto.AccountDTO">
		SELECT *
		FROM ACCOUNT
		WHERE ACCOUNT_NO = #{accountNo}
	</select>

	<!-- 새로운 account 데이터를 삽입하는 쿼리 -->
	<insert id="accountCreate">
		INSERT INTO ACCOUNT (
		ACCOUNT_NO,
		ACCOUNT_NAME,
		BUSINESS_TYPE,
		ITEMS,
		BOSS_NAME,
		BUSINESS_NUMBER, 
		BIZ_NUMBER,       <!-- biz_number -->
		ACCOUNT_ADDRESS,
		ACCOUNT_PHONE,
		EMAIL
		)
		VALUES (
		#{bizNumber} || 'A' || TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(ACCOUNT_SEQ.NEXTVAL,
		5, '0'),
		#{accountName},
		#{businessType},
		#{items},
		#{bossName},
		#{businessNumber},
		#{bizNumber},      <!-- biz_number 값  -->
		#{accountAddress},
		#{accountPhone},
		#{email}
		)
	</insert>


	<!-- 특정 account 데이터를 ACCOUNT_NO로 조회하는 쿼리 -->
	<select id="selectAccountByAccountNo" parameterType="String"
		resultMap="accountResult">
		SELECT * FROM ACCOUNT WHERE
		ACCOUNT_NO = #{accountNo}
	</select>

	<!-- 특정 account 데이터를 ACCOUNT_NO로 업데이트하는 쿼리 -->
	<update id="updateAccount"
		parameterType="com.e3i3.moduerp.account.model.dto.AccountDTO">
		UPDATE ACCOUNT
		SET ACCOUNT_NAME = #{accountName},
		BUSINESS_TYPE = #{businessType}, ITEMS = #{items},
		BOSS_NAME =
		#{bossName}, BUSINESS_NUMBER =
		#{businessNumber},
		ACCOUNT_ADDRESS =
		#{accountAddress}, ACCOUNT_PHONE =
		#{accountPhone},
		EMAIL = #{email}
		WHERE ACCOUNT_NO = #{accountNo}
	</update>

	<!-- 특정 ACCOUNT_NO로 account 데이터를 삭제하는 쿼리 -->
	<delete id="deleteAccountByAccountNo" parameterType="String">
		DELETE FROM
		ACCOUNT WHERE ACCOUNT_NO = #{accountNo}
	</delete>


	<!-- filter !!!!!!!!!! -->
	<!-- Account Name 필터 -->
	<select id="selectAccountsByAccountName" parameterType="map"
		resultType="com.e3i3.moduerp.account.model.dto.AccountDTO">
		SELECT *
		FROM ACCOUNT
		WHERE BIZ_NUMBER LIKE #{bizNumber}
		AND
		UPPER(ACCOUNT_NAME) LIKE '%' || UPPER(#{filterText}) || '%'
	</select>

	<!-- Business Number 필터 -->
	<select id="selectAccountsByBusinessNumber" parameterType="map"
		resultType="com.e3i3.moduerp.account.model.dto.AccountDTO">
		SELECT *
		FROM ACCOUNT
		WHERE BIZ_NUMBER LIKE #{bizNumber}
		AND
		BUSINESS_NUMBER LIKE '%' || #{filterText} || '%'
	</select>

	<!-- Boss Name 필터 -->
	<select id="selectAccountsByBossName" parameterType="map"
		resultType="com.e3i3.moduerp.account.model.dto.AccountDTO">
		SELECT *
		FROM ACCOUNT
		WHERE BIZ_NUMBER LIKE #{bizNumber}
		AND
		UPPER(BOSS_NAME) LIKE '%' || UPPER(#{filterText}) || '%'
	</select>



</mapper>
